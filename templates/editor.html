<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Auto Stat Description Editor</title>
  <link rel="stylesheet" href="/static/editor.css">
</head>
<body>
  <div class="bg-shape bg-shape-a"></div>
  <div class="bg-shape bg-shape-b"></div>
  <div class="theme-corner">
    <label class="theme-switch" for="themeToggle" title="Toggle light and dark mode">
      <input id="themeToggle" type="checkbox" checked>
      <span class="theme-switch-track">
        <span class="theme-switch-icon theme-switch-icon-sun">☀</span>
        <span class="theme-switch-icon theme-switch-icon-moon">☾</span>
        <span class="theme-switch-thumb"></span>
      </span>
    </label>
  </div>
  <div class="app-shell">
    <header class="topbar card">
      <div>
        <p class="eyebrow">Auto Stat Description</p>
        <h1>Description Editor</h1>
        <p class="subtext">Design your Strava description template with live preview.</p>
      </div>
      <div class="status-block" id="topStatus">Ready</div>
    </header>

    <section class="actions card">
      <button id="btnLoadActive" class="btn">Load Active</button>
      <button id="btnLoadDefault" class="btn btn-ghost">Load Default</button>
      <button id="btnLoadDraft" class="btn btn-ghost" title="Load your locally saved browser draft">Load Draft</button>
      <button id="btnSaveDraft" class="btn btn-ghost" title="Save current editor content locally in your browser">Save Draft</button>
      <button id="btnTour" class="btn btn-ghost" title="Open quick onboarding tour">Tour</button>
      <button id="btnFormatTemplate" class="btn btn-ghost" title="Normalize line endings, trim trailing spaces, and collapse large blank blocks">Format</button>
      <button id="btnValidate" class="btn btn-secondary">Validate</button>
      <button id="btnPreview" class="btn btn-secondary">Preview</button>
      <button id="btnSave" class="btn btn-primary">Save + Publish</button>
      <button id="btnCopyPreview" class="btn btn-ghost">Copy Preview</button>
      <label class="toggle-inline" for="autoPreviewToggle">
        <input id="autoPreviewToggle" type="checkbox" checked>
        Auto-preview
      </label>
    </section>

    <main class="layout">
      <aside class="panel card reveal" style="--delay:0.03s">
        <h2>Available Data</h2>
        <p class="subtext">Click any field to insert it into the advanced editor.</p>
        <label class="stack-label" for="schemaContextMode">Catalog Context</label>
        <select id="schemaContextMode" class="search">
          <option value="sample" selected>Sample Only</option>
          <option value="fixture">Fixture</option>
          <option value="latest">Latest Only</option>
          <option value="latest_or_sample">Latest or Sample</option>
        </select>
        <label class="stack-label" for="schemaSourceFilter">Source Filter</label>
        <select id="schemaSourceFilter" class="search">
          <option value="all" selected>All Sources</option>
        </select>
        <label class="stack-label" for="schemaGroupFilter">Group Filter</label>
        <select id="schemaGroupFilter" class="search">
          <option value="all" selected>All Groups</option>
        </select>
        <label class="stack-label" for="schemaTypeFilter">Type Filter</label>
        <select id="schemaTypeFilter" class="search">
          <option value="all" selected>All Types</option>
        </select>
        <label class="stack-label" for="schemaTagFilter">Tag Filter</label>
        <select id="schemaTagFilter" class="search">
          <option value="all" selected>All Tags</option>
        </select>
        <label class="toggle-inline" for="schemaCuratedOnly">
          <input id="schemaCuratedOnly" type="checkbox">
          Curated Fields Only
        </label>
        <input id="schemaSearch" class="search" type="search" placeholder="Search fields...">
        <div id="schemaMeta" class="meta"></div>
        <div id="catalogDiagnostics" class="meta">No diagnostics yet.</div>
        <div id="schemaList" class="catalog"></div>
      </aside>

      <section class="panel card reveal" style="--delay:0.07s">
        <div class="snippet-shell repository-shell">
          <div class="snippet-head">
            <h3>Template Repository</h3>
            <p class="subtext">Save, organize, import, export, and load templates from persistent storage.</p>
          </div>
          <div class="advanced-toolbar repository-select-row">
            <label for="repositoryTemplateSelect">Library</label>
            <select id="repositoryTemplateSelect">
              <option value="" selected>Loading templates...</option>
            </select>
            <button id="btnRepoLoad" class="btn btn-secondary" type="button">Load Highlighted</button>
          </div>
          <div class="advanced-toolbar repository-meta-row">
            <label for="repoTemplateNameInput">Title</label>
            <input id="repoTemplateNameInput" type="text" placeholder="Template title">
            <label for="repoTemplateAuthorInput">Author</label>
            <input id="repoTemplateAuthorInput" type="text" placeholder="Template author">
          </div>
          <div id="repositoryTemplateMeta" class="meta">No repository template selected.</div>
          <div class="inline-actions">
            <button id="btnRepoSave" class="btn btn-secondary" type="button">Save</button>
            <button id="btnRepoSaveAs" class="btn btn-ghost" type="button">Save As</button>
            <button id="btnRepoDuplicate" class="btn btn-ghost" type="button">Duplicate</button>
            <button id="btnRepoImport" class="btn btn-ghost" type="button">Import</button>
            <button id="btnRepoExport" class="btn btn-ghost" type="button">Export</button>
          </div>
          <input id="importTemplateFile" type="file" accept="application/json,.json" hidden>
        </div>
        <div class="tabbar">
          <button class="tab active" data-tab="simple">Simple Builder</button>
          <button class="tab" data-tab="advanced">Advanced Template</button>
        </div>

        <div id="tabSimple" class="tabpanel active">
          <p class="subtext">Toggle sections, reorder them, then apply to the advanced editor.</p>
          <div id="simpleSections" class="sections"></div>
          <div class="inline-actions">
            <button id="btnSimpleApply" class="btn btn-secondary">Apply To Advanced</button>
            <button id="btnSimpleReset" class="btn btn-ghost">Reset Builder</button>
          </div>
        </div>

        <div id="tabAdvanced" class="tabpanel">
          <div class="advanced-toolbar">
            <label for="previewContextMode">Preview Context</label>
            <select id="previewContextMode">
              <option value="sample" selected>Sample Only</option>
              <option value="fixture">Fixture</option>
              <option value="latest_or_sample">Latest or Sample</option>
              <option value="latest">Latest Only</option>
            </select>
            <label for="previewFixtureName">Fixture</label>
            <select id="previewFixtureName">
              <option value="default" selected>default</option>
            </select>
          </div>
          <div id="contextSafetyBanner" class="context-banner safe">SAFE mode: sample/fixture preview with no live payload dependency.</div>
          <div class="snippet-shell">
            <div class="snippet-head">
              <h3>Starter Templates</h3>
              <p class="subtext">Start from a curated layout, then customize.</p>
            </div>
            <div class="advanced-toolbar">
              <label for="starterTemplateSelect">Preset</label>
              <select id="starterTemplateSelect">
                <option value="" selected>Loading starters...</option>
              </select>
              <button id="btnStarterPreview" class="btn btn-secondary" type="button">Preview Starter</button>
              <button id="btnStarterApply" class="btn btn-ghost" type="button">Apply Starter</button>
            </div>
            <div id="starterTemplateMeta" class="meta">No starter selected.</div>
          </div>
          <label for="templateEditor">Jinja Template</label>
          <textarea id="templateEditor" spellcheck="false"></textarea>
          <div class="snippet-shell">
            <div class="snippet-head">
              <h3>Snippet Palette</h3>
              <p class="subtext">Tap to insert starter blocks at your cursor.</p>
            </div>
            <div id="snippetList" class="snippets"></div>
          </div>
          <div id="validationPane" class="validation"></div>
          <div class="snippet-shell">
            <div class="snippet-head">
              <h3>Reference Links</h3>
              <p class="subtext">Quick links for data source docs and Jinja syntax.</p>
            </div>
            <div class="help-links">
              <a href="https://developers.strava.com/docs/reference/" target="_blank" rel="noopener noreferrer">Strava API Docs</a>
              <a href="https://intervals.icu/api-docs.html" target="_blank" rel="noopener noreferrer">Intervals.icu API</a>
              <a href="https://www.weatherapi.com/docs/" target="_blank" rel="noopener noreferrer">WeatherAPI Docs</a>
              <a href="https://api.smashrun.com/v1/documentation" target="_blank" rel="noopener noreferrer">Smashrun API Docs</a>
              <a href="https://jinja.palletsprojects.com/en/stable/templates/" target="_blank" rel="noopener noreferrer">Jinja Template Reference</a>
            </div>
          </div>
        </div>
      </section>

      <section class="panel card reveal" style="--delay:0.1s">
        <h2>Preview</h2>
        <p class="subtext">Rendered from selected context mode. Sample mode does not call upstream services.</p>
        <div class="meta" id="previewMeta">No preview yet.</div>
        <pre id="previewText" class="preview"></pre>
        <div class="snippet-shell">
          <div class="snippet-head">
            <h3>Template History</h3>
            <p class="subtext">Load or rollback to previous published versions.</p>
            <button id="btnRefreshHistory" class="btn btn-ghost">Refresh History</button>
          </div>
          <div id="templateMeta" class="meta">No template metadata.</div>
          <div id="versionList" class="catalog"></div>
        </div>
      </section>
    </main>
  </div>

  <div id="tourModal" class="modal-shell" aria-hidden="true">
    <div class="modal-card card tour-card" role="dialog" aria-modal="true" aria-labelledby="tourStepTitle">
      <div class="modal-head">
        <h2 id="tourStepTitle">Welcome</h2>
        <button id="btnTourSkip" class="btn btn-ghost" type="button">Skip</button>
      </div>
      <div id="tourStepCounter" class="meta">Step 1 / 4</div>
      <div id="tourStepBody" class="tour-body">Use this editor to design and publish your activity description template.</div>
      <div class="inline-actions">
        <button id="btnTourPrev" class="btn btn-ghost" type="button">Back</button>
        <button id="btnTourNext" class="btn btn-secondary" type="button">Next</button>
        <button id="btnTourDone" class="btn btn-primary" type="button">Done</button>
      </div>
    </div>
  </div>

  <div id="publishModal" class="modal-shell" aria-hidden="true">
    <div class="modal-card card" role="dialog" aria-modal="true" aria-labelledby="publishModalTitle">
      <div class="modal-head">
        <h2 id="publishModalTitle">Confirm Publish</h2>
        <button id="publishCloseBtn" class="btn btn-ghost" type="button">Close</button>
      </div>
      <p class="subtext">Publishing replaces the active template used by the worker/API.</p>
      <div id="publishModeBanner" class="context-banner safe">SAFE</div>
      <div id="publishValidationSummary" class="validation"></div>
      <div id="publishDiffSummary" class="meta"></div>
      <pre id="publishDiffView" class="preview diff-view"></pre>
      <label class="toggle-inline" for="publishChecklistReviewed">
        <input id="publishChecklistReviewed" type="checkbox">
        I reviewed the diff
      </label>
      <label class="toggle-inline" for="publishChecklistReplace">
        <input id="publishChecklistReplace" type="checkbox">
        I understand this replaces the active template
      </label>
      <div class="inline-actions">
        <button id="publishCancelBtn" class="btn btn-ghost" type="button">Cancel</button>
        <button id="publishConfirmBtn" class="btn btn-primary" type="button" disabled>Publish Now</button>
      </div>
    </div>
  </div>

  <script src="/static/editor.js"></script>
</body>
</html>
