<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chronicle Plan</title>
  <meta name="theme-color" content="#ff6a00">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Chronicle">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.webmanifest') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/favicon-32.png') }}">
  <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192.png') }}">
  <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='icons/icon-512.png') }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icons/apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='chronicle.png') }}">
  <link rel="stylesheet" href="/static/ui-theme.css">
  <link rel="stylesheet" href="/static/plan.css">
</head>
<body class="plan-page">
  {% include "_app_shell_nav.html" %}

  <aside id="planPaceDrawer" class="plan-pace-drawer" aria-hidden="true">
    <div class="plan-pace-handles">
      <button id="planPaceDrawerTab" class="plan-pace-tab" type="button" aria-label="Open pace workshop">Pace Workshop</button>
    </div>
    <div class="plan-pace-head">
      <h2>Pace Workshop</h2>
      <button id="planPaceDrawerClose" class="plan-pace-close" type="button">Close</button>
    </div>
    <div class="plan-pace-body">
      <section class="plan-pace-section">
        <h3>Current Marathon Goal</h3>
        <p class="muted">Default is 5:00:00 on fresh install.</p>
        <div class="plan-pace-inline">
          <input id="planMarathonGoalInput" type="text" inputmode="numeric" placeholder="H:MM:SS" aria-label="Marathon goal time">
          <button id="planMarathonGoalSetBtn" type="button">Set Goal</button>
        </div>
      </section>
      <section class="plan-pace-section">
        <h3>Pace Calculator</h3>
        <p class="muted">Enter a recent race result to estimate race equivalencies and training paces.</p>
        <div class="plan-pace-inline">
          <select id="planPaceDistanceSelect" aria-label="Race distance"></select>
          <input id="planPaceTimeInput" type="text" inputmode="numeric" placeholder="H:MM:SS" aria-label="Race finish time">
          <button id="planPaceCalcBtn" type="button">Calculate</button>
        </div>
      </section>
      <section class="plan-pace-section">
        <div class="plan-pace-derived-row">
          <h3>Race Equivalency</h3>
          <button id="planPaceSetDerivedBtn" type="button" disabled>Set as Goal</button>
        </div>
        <p id="planPaceDerivedGoal" class="plan-pace-derived-goal">Marathon Equivalent: --</p>
        <div id="planRaceEquivalencyList" class="plan-pace-grid"></div>
      </section>
      <section class="plan-pace-section">
        <h3>Training Paces</h3>
        <p class="muted">Calculated from nearest marathon-goal lookup row.</p>
        <div id="planTrainingPacesList" class="plan-pace-grid"></div>
      </section>
      <p id="planPaceStatus" class="plan-pace-status" aria-live="polite"></p>
    </div>
  </aside>
  <div id="planPaceBackdrop" class="plan-pace-backdrop" aria-hidden="true"></div>

  <div class="plan-shell">
    <section class="plan-heading">
      <div class="plan-heading-row">
        <div>
          <h1>Plan</h1>
          <p class="muted">Trailing two weeks and next two weeks centered on today with derived load and adherence metrics.</p>
        </div>
        <button id="planSettingsBtn" class="plan-settings-btn" type="button" title="Plan settings" aria-label="Plan settings">âš™</button>
      </div>
      <div id="planTopMeta" class="plan-meta">Loading...</div>
      <div id="planSettingsPanel" class="plan-settings-panel" hidden>
        <h2>Plan Settings</h2>
        <p class="muted">Seed past expected mileage by copying actual mileage into expected for each past day.</p>
        <button id="planSeedBtn" class="plan-seed-btn" type="button">Seed Expected From Actual</button>
        <p id="planSettingsStatus" class="plan-settings-status" aria-live="polite"></p>
      </div>
    </section>
    <section id="planSummary" class="plan-summary card"></section>

    <section class="plan-grid card">
      <div class="plan-grid-tools">
        <div class="plan-grid-controls">
          <input id="planCenterDate" type="date">
          <button id="planCenterBtn" type="button">Center</button>
          <button id="planReloadBtn" type="button">Reload</button>
        </div>
        <div class="plan-legend" role="note" aria-label="Metric color legend">
          <span class="legend-chip legend-caution">Low</span>
          <span class="legend-chip legend-good">Optimal</span>
          <span class="legend-chip legend-hard">Risk</span>
        </div>
      </div>
      <div class="plan-table-wrap" role="region" aria-label="Plan table">
        <table class="plan-table">
          <thead>
            <tr>
              <th>Done</th>
              <th>Date</th>
              <th>Distance (MI)</th>
              <th>Run Type</th>
              <th title="Total Weekly Mileage">Week Mi</th>
              <th title="Week over Week Change">WoW</th>
              <th>Long%</th>
              <th title="Total Monthly Mileage">Month Mi</th>
              <th title="Month over Month Change">MoM</th>
              <th title="Cumulative Mileage (Trailing 7 Day)">T7 Mi</th>
              <th>T7D / P7D</th>
              <th title="Cumulative Mileage (Trailing 30 Day)">T30 Mi</th>
              <th>T30D / P30D</th>
              <th title="Average Miles per Day (Trailing 30 Day)">Avg Mi/day</th>
              <th title="Miles / Trailing 30 Day Average">Mi/T30</th>
            </tr>
          </thead>
          <tbody id="planTableBody"></tbody>
        </table>
      </div>
    </section>
  </div>

  <script src="/static/plan.js"></script>
</body>
</html>
